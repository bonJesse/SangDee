workflows:
  ios-build:
    name: iOS Build Workflow for Xcode 16.1 and iOS 18.1
    max_build_duration: 60 # Set max build duration in minutes
    steps:
      # Checkout source code from GitHub
      - checkout:
          repository: https://github.com/bonJesse/SangDee.git

      # Install dependencies (CocoaPods)
      - run:
          name: Install dependencies
          command: |
            cd SangDee/SangDee-iOS
            gem install cocoapods
            pod install

      # Build the app using xcodebuild
      - run:
          name: Build iOS App
          command: |
            cd SangDee/SangDee-iOS
            xcodebuild clean build -workspace SangDee.xcworkspace -scheme SangDee-iOS -sdk iphoneos

      # Export the .ipa file
      - run:
          name: Export .ipa
          command: |
            cd SangDee/SangDee-iOS
            xcodebuild -exportArchive -archivePath $PWD/build/ios/iphoneos/SangDee-iOS.xcarchive -exportOptionsPlist exportOptions.plist -exportPath $PWD/build/ipa

      # Upload the .ipa file to Artifacts
      - upload:
          artifact: SangDee/SangDee-iOS/build/ipa/*.ipa
          name: ipa
